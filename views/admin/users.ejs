<!-- Admin - Kullanıcı Yönetimi -->
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="card border-0 shadow mb-4">
        <div class="card-header bg-white py-3">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold">Kullanıcı Yönetimi</h5>
            <a href="/admin/users/new" class="btn btn-sm btn-primary">
              <i class="fas fa-plus me-1"></i> Yeni Kullanıcı
            </a>
          </div>
        </div>
        <div class="card-body p-0">
          <!-- Arama ve Filtreleme -->
          <div class="p-3 border-bottom">
            <div class="row g-2">
              <div class="col-md-4">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Kullanıcı ara..." id="userSearchInput">
                  <button class="btn btn-outline-secondary" type="button">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="userRoleFilter">
                  <option value="all">Tüm Roller</option>
                  <option value="admin">Yönetici</option>
                  <option value="user">Kullanıcı</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="userStatusFilter">
                  <option value="all">Tüm Durumlar</option>
                  <option value="active">Aktif</option>
                  <option value="inactive">Pasif</option>
                </select>
              </div>
              <div class="col-md-2 text-end">
                <button class="btn btn-outline-secondary w-100" id="resetFilters">
                  <i class="fas fa-sync-alt me-1"></i> Sıfırla
                </button>
              </div>
            </div>
          </div>
          
          <!-- Kullanıcı Listesi -->
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th scope="col" class="ps-3">Kullanıcı</th>
                  <th scope="col">E-posta</th>
                  <th scope="col">Rol</th>
                  <th scope="col">Son Giriş</th>
                  <th scope="col">Durum</th>
                  <th scope="col">İşlemler</th>
                </tr>
              </thead>
              <tbody id="userTableBody">
                <% if (users && users.length > 0) { %>
                  <% users.forEach(function(user) { %>
                    <tr>
                      <td class="ps-3">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0">
                            <img src="https://placehold.co/40x40?text=<%= user.displayName ? user.displayName.charAt(0) : 'U' %>" alt="User Avatar" class="rounded-circle">
                          </div>
                          <div class="flex-grow-1 ms-2">
                            <h6 class="mb-0"><%= user.displayName || 'Kullanıcı' %></h6>
                            <small class="text-muted"><%= user.id.substring(0, 8) %>...</small>
                          </div>
                        </div>
                      </td>
                      <td><%= user.email %></td>
                      <td>
                        <% if (user.isAdmin) { %>
                          <span class="badge bg-primary">Admin</span>
                        <% } else { %>
                          <span class="badge bg-secondary">Kullanıcı</span>
                        <% } %>
                      </td>
                      <td>
                        <% if (user.lastLoginDate) { %>
                          <%= user.lastLoginDate.toLocaleDateString('tr-TR') %> <%= user.lastLoginDate.toLocaleTimeString('tr-TR') %>
                        <% } else { %>
                          <span class="text-muted">Giriş yapmadı</span>
                        <% } %>
                      </td>
                      <td>
                        <% if (user.isActive) { %>
                          <span class="badge bg-success">Aktif</span>
                        <% } else { %>
                          <span class="badge bg-danger">Pasif</span>
                        <% } %>
                      </td>
                      <td>
                        <div class="btn-group">
                          <a href="/admin/users/<%= user.id %>" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-eye"></i>
                          </a>
                          <a href="/admin/users/<%= user.id %>/edit" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-edit"></i>
                          </a>
                          <button type="button" class="btn btn-sm btn-outline-danger" 
                                  data-bs-toggle="modal" 
                                  data-bs-target="#deleteUserModal" 
                                  data-user-id="<%= user.id %>" 
                                  data-user-name="<%= user.displayName || user.email %>">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  <% }); %>
                <% } else { %>
                  <tr>
                    <td colspan="6" class="text-center py-4">
                      <div class="py-5">
                        <i class="fas fa-users fa-3x text-muted mb-3"></i>
                        <h5>Henüz kullanıcı bulunmuyor</h5>
                        <p class="text-muted">İlk kullanıcıyı eklemek için "Yeni Kullanıcı" butonuna tıklayın</p>
                      </div>
                    </td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          
          <!-- Sayfalama -->
          <div class="d-flex justify-content-between align-items-center p-3">
            <div>
              <span class="text-muted small">Toplam <strong><%= users ? users.length : 0 %></strong> kullanıcı</span>
            </div>
            <nav aria-label="Page navigation">
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Önceki</a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                  <a class="page-link" href="#">Sonraki</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Kullanıcı Silme Modal -->
<div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteUserModalLabel">Kullanıcı Sil</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Bu kullanıcıyı silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.</p>
        <p class="fw-bold user-name-display"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
        <form id="deleteUserForm" action="/admin/users/delete" method="POST">
          <input type="hidden" name="userId" id="deleteUserId">
          <button type="submit" class="btn btn-danger">Sil</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Kullanıcı silme modalı
    const deleteUserModal = document.getElementById('deleteUserModal');
    if (deleteUserModal) {
      deleteUserModal.addEventListener('show.bs.modal', function(event) {
        const button = event.relatedTarget;
        const userId = button.getAttribute('data-user-id');
        const userName = button.getAttribute('data-user-name');
        
        const modalUserName = this.querySelector('.user-name-display');
        const deleteUserIdInput = document.getElementById('deleteUserId');
        
        modalUserName.textContent = userName;
        deleteUserIdInput.value = userId;
      });
    }
    
    // Kullanıcı arama fonksiyonu
    const searchInput = document.getElementById('userSearchInput');
    if (searchInput) {
      searchInput.addEventListener('keyup', function() {
        const searchValue = this.value.toLowerCase();
        const userRows = document.querySelectorAll('#userTableBody tr');
        
        userRows.forEach(function(row) {
          const userName = row.querySelector('h6').textContent.toLowerCase();
          const userEmail = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
          
          if (userName.includes(searchValue) || userEmail.includes(searchValue)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      });
    }
  });
</script>